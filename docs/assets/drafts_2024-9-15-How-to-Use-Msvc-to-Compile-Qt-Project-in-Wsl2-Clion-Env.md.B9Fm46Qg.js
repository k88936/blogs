import{_ as i,c as a,o as t,af as l}from"./chunks/framework.CgieQmbq.js";const F=JSON.parse('{"title":"The problem to be solved","description":"","frontmatter":{"layout":"post","tags":"cpp,wsl2,clion,qt,msvc"},"headers":[],"relativePath":"drafts/2024-9-15-How-to-Use-Msvc-to-Compile-Qt-Project-in-Wsl2-Clion-Env.md","filePath":"drafts/2024-9-15-How-to-Use-Msvc-to-Compile-Qt-Project-in-Wsl2-Clion-Env.md"}'),e={name:"drafts/2024-9-15-How-to-Use-Msvc-to-Compile-Qt-Project-in-Wsl2-Clion-Env.md"};function h(n,s,k,p,o,r){return t(),a("div",null,[...s[0]||(s[0]=[l(`<h1 id="the-problem-to-be-solved" tabindex="-1">The problem to be solved <a class="header-anchor" href="#the-problem-to-be-solved" aria-label="Permalink to “The problem to be solved”">​</a></h1><p>I want to work on clion on wsl2 ,to build a multiplatform product, having some problem on MinGW , so I turned to MSVC</p><h2 id="prepare" tabindex="-1">prepare <a class="header-anchor" href="#prepare" aria-label="Permalink to “prepare”">​</a></h2><ul><li>wsl2 is the basis of our discussion.</li><li>install MSVC ,I choosed Visual Studio 2022 Community.</li><li>install Qt6,I installed on C:Qt6, <em>note install msvc2019_64 version</em></li></ul><h2 id="steps" tabindex="-1">steps <a class="header-anchor" href="#steps" aria-label="Permalink to “steps”">​</a></h2><ol><li><p><strong>invoke MSVC tools</strong><br> the problem is MSVC has its own env so calling cmake.exe or cl.exe in wsl2 will not work so I turned to call the Powershell for Visual Studio dev and invoke cmake.exe there</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">powershell.exe</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;&amp; &#39;C:\\Program Files\\Microsoft Visual Studio\\2022\\Community\\Common7\\Tools\\Launch-VsDevShell.ps1&#39; -SkipAutomaticLocation;cmake ...&quot;</span></span></code></pre></div><p>pay attention to the method to make a Powershell.exe for dev.</p></li><li><p><strong>config Qt6 Compile</strong><br> we need to add &quot;-DCMAKE_TOOLCHAIN_FILE=C:\\Qt\\6.7.2\\msvc2019_64\\lib\\cmake\\Qt6\\qt.toolchain.cmake&quot; for cmake to recognize Qt6 cmake project<br> And a param &quot;-DCMAKE_CXX_FLAGS=&#39;-std:c++20 -Zc:__cplusplus&#39;&quot; should be set to solve MSVC build problem</p></li><li><p><strong>prepare a space to build</strong> there is some problem to run MSVC cmake.exe in wsl2 file system. So I determined a place to build.<br> Also to make everything auto ,I Write a Makefiles</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">projectName</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">shell</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> basename</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CURDIR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">projectPath</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">D:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">linux</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">subst</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">shell</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pwd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">msvc:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    powershell.exe</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;&amp; &#39;C:\\Program Files\\Microsoft Visual Studio\\2022\\Community\\Common7\\Tools\\Launch-VsDevShell.ps1&#39; -SkipAutomaticLocation;cmake -DCMAKE_BUILD_TYPE=Release  -DCMAKE_TOOLCHAIN_FILE=C:\\Qt\\6.7.2\\msvc2019_64\\lib\\cmake\\Qt6\\qt.toolchain.cmake  -DCMAKE_CXX_FLAGS=&#39;-std:c++20 -Zc:__cplusplus&#39; -S . -B $(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">projectPath</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">cmake-build-msvc&quot;</span></span></code></pre></div><p><em>note: when I choose Ninja as thr build program, it fails with qt6 not configured well,however the Visual Studio build the project in IDE using Ninja can work</em></p></li><li><p><strong>do the rest thing</strong><br> build, windeployqt:</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">powershell.exe</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;&amp; &#39;C:\\Program Files\\Microsoft Visual Studio\\2022\\Community\\Common7\\Tools\\Launch-VsDevShell.ps1&#39; -SkipAutomaticLocation;msbuild $(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">projectPath</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">cmake-build-msvc</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">projectName</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">).sln /p:Configuration=Release&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/mnt/c/Qt/6.7.2/msvc2019_64/bin/windeployqt.exe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">projectPath</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">cmake-build-msvc</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Release</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\\\</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">projectName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.exe</span></span></code></pre></div></li></ol><h2 id="compose-them-all" tabindex="-1">compose them all <a class="header-anchor" href="#compose-them-all" aria-label="Permalink to “compose them all”">​</a></h2><div class="language-make"><button title="Copy Code" class="copy"></button><span class="lang">make</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">.PHONY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:msvc</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">projectName=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">shell</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> basename $(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CURDIR</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">projectPath=D:\\\\linux</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">subst</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /,\\\\,$(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">shell</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pwd))</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">msvc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    mkdir -p /mnt/d/linux</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">shell</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pwd)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    powershell.exe</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> -c</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  &quot;&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> &#39;C</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:\\Program Files\\Microsoft Visual Studio\\2022\\Community\\Common7\\Tools\\Launch-VsDevShell.ps1&#39; -SkipAutomaticLocation;cmake -DCMAKE_BUILD_TYPE=Release  -DCMAKE_TOOLCHAIN_FILE=C:\\Qt\\6.7.2\\msvc2019_64\\lib\\cmake\\Qt6\\qt.toolchain.cmake  -DCMAKE_CXX_FLAGS=&#39;-std:c++20 -Zc:__cplusplus&#39; -S . -B </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">projectPath</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">\\\\cmake-build-msvc&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    powershell.exe</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> -c</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  &quot;&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> &#39;C</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:\\Program Files\\Microsoft Visual Studio\\2022\\Community\\Common7\\Tools\\Launch-VsDevShell.ps1&#39; -SkipAutomaticLocation;msbuild </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">projectPath</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">\\\\cmake-build-msvc\\\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">projectName</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.sln /p:Configuration=Release&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    /mnt/c/Qt/6.7.2/msvc2019_64/bin/windeployqt.exe </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">projectPath</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">\\\\cmake-build-msvc\\\\Release\\\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">projectName</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.exe</span></span></code></pre></div>`,8)])])}const c=i(e,[["render",h]]);export{F as __pageData,c as default};
